---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(readxl)
library(janitor)
library(plyr)
library(dplyr)
library(ggplot2)
library(RColorBrewer)
```
```{r}
MASTER <- read_xlsx("DEPENd/NeuroMAP/Recruitment/Participant Management/NEUROMAP Master V2.xlsm", sheet = "MasterData")
as_tibble(MASTER)
TIMELINE <- read_xlsx("DEPENd/NeuroMAP/Recruitment/Participant Management/RO1 Timeline.xlsx", sheet = "R01 Timeline")
AGGREGATE <- read_xlsx("DEPENd/NeuroMAP/Recruitment/Participant Management/RO1 Timeline.xlsx", sheet = "Aggregate")

```

```{r}
#tidy up column names for MASTER
MASTER<-dplyr::rename(MASTER, PAI= "PAI (M)", AI = "AI (M)", SH = "SH (M)", SPIN = "SPIN (M)", SCREEN_SENTDATE = "SCREEN: SENT DATE (M)", SCREEN_COMPLETEDATE = "SCREEN: COMPLETE DATE (M)", SCREEN_COMPLETEYN =  "SCREEN: COMPLETE Y/N (M)")
MASTER<-dplyr::rename(MASTER, INEL_CODE = "INELEGIBILITY CODE (M)", INEL_PHASE ="PHASE DEEMED INELIGIBLE (M)", INEL_YN = "ELIGIBLE YN (M)",  GROUP_SL = "GROUPED: SL (M)" )
MASTER<-dplyr::rename(MASTER, S1_DATE = "S1 DATE (M)", S2_DATE ="S2 DATE (M)", S3_DATE = "S3 DATE (M)", S4_DATE = "S4 DATE (M)", S5_DATE = "S5 DATE (M)", INVITES1_YN = "INVITED TO S1 (M)")

AGGREGATE <- dplyr::rename (AGGREGATE, STUDY_YEAR = YEAR) %>%
  dplyr::group_by(AGGREGATE, STUDY_YEAR)

colnames(AGGREGATE)

#convert dates to proper format
MASTER$SCREEN_COMPLETEDATE<-excel_numeric_to_date(as.numeric(as.character(MASTER$SCREEN_COMPLETEDATE)), date_system = "modern")    
MASTER$S1_DATE<-excel_numeric_to_date(as.numeric(as.character(MASTER$S1_DATE)), date_system = "modern")    
MASTER$SCREEN_SENTDATE<-excel_numeric_to_date(as.numeric(as.character(MASTER$SCREEN_SENTDATE)), date_system = "modern")    
as.factor(MASTER$SOURCE)

```

```{r}
MONTHLY <- MASTER %>% 
  dplyr::select(NAME, STATUS, GROUP, S1_DATE, S2_DATE, S3_DATE, S4_DATE, S5_DATE, SCREEN_SENTDATE) %>%
  ##group_by(STATUS, GROUP) %>%
  ##arrange()
  filter(SCREEN_SENTDATE >= as.Date("2019-07-24") & SCREEN_SENTDATE <= as.Date("2019-07-30"), STATUS == "Invited S1")

WEEKLY <- MASTER %>% 
  dplyr::select(NAME, STATUS, SCREEN_SENTDATE, SCREEN_COMPLETEDATE, SCREEN_COMPLETEYN, GROUP, SOURCE) %>%
  filter(SCREEN_SENTDATE >= as.Date("2019-08-01") & SCREEN_SENTDATE <= as.Date(" 2019-08-30"))

(WEEKLY)
```


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

